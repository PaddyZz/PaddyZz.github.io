<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>House Price Prediction - Paddy - Paddy&#039;s Log Book</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Paddy - Paddy&#039;s Log Book"><meta name="msapplication-TileImage" content="/images/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Paddy - Paddy&#039;s Log Book"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="House Price Prediction"><meta property="og:type" content="blog"><meta property="og:title" content="House Price Prediction"><meta property="og:url" content="http://paddyzz.github.io/projects/House_Price_Prediction/"><meta property="og:site_name" content="Paddy - Paddy&#039;s Log Book"><meta property="og:description" content="House Price Prediction"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://paddyzz.github.io/img/og_image.png"><meta property="article:published_time" content="2024-06-02T12:46:51.914Z"><meta property="article:modified_time" content="2024-06-26T12:56:41.072Z"><meta property="article:author" content="Paddy"><meta property="article:tag" content="PROJECTS"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://paddyzz.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://paddyzz.github.io/projects/House_Price_Prediction/"},"headline":"House Price Prediction","image":["http://paddyzz.github.io/img/og_image.png"],"datePublished":"2024-06-02T12:46:51.914Z","dateModified":"2024-06-26T12:56:41.072Z","author":{"@type":"Person","name":"Paddy"},"publisher":{"@type":"Organization","name":"Paddy - Paddy's Log Book","logo":{"@type":"ImageObject","url":"http://paddyzz.github.io/images/favicon.png"}},"description":"House Price Prediction"}</script><link rel="canonical" href="http://paddyzz.github.io/projects/House_Price_Prediction/"><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="follow.it-verification-code" content="SdbKP9l6XayZRBYCuvDS"><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><script type="text/javascript" src="/js/svg-inject.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gsap@3.3.4/dist/gsap.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gsap@3.3.4/dist/ScrollTrigger.js"></script><progress max="100" value="0"></progress><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicon.png" alt="Paddy - Paddy&#039;s Log Book" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">PADDY&#039;S LOG BOOK</a><a class="navbar-item" href="/curriculum/">CURRICULUM</a><a class="navbar-item" href="/blogs/">BLOGS</a><a class="navbar-item" href="/projects/">PROJECTS</a><a class="navbar-item" href="/life/">LIFE</a><a class="navbar-item" href="/archives/">ARCHIVES</a><a class="navbar-item" href="/categories/">CATEGORIES</a><a class="navbar-item" href="/tags/">TAGS</a><a class="navbar-item" href="/faqs/">FAQS</a></div><div class="navbar-end"><a class="navbar-item navbar-item-logo" id="star-nav" title="Nox Tenebratio!" style="opacity:0;display:none;userSelect:none;" href="javascript:;"><i class="fa fa-star-and-crescent" id="star-icon" style="font-size:17.75px"></i></a><a class="navbar-item navbar-item-logo night" id="night-nav" title="Nox!" href="javascript:;"><i class="fas fa-moon" id="night-icon" style="font-size:16.75px"></i></a><a class="navbar-item navbar-item-logo" id="night-nav" title="Email" href="mailto:jiahe.zhao@uq.net.au?body=Hello%2C%0A%0AIt%20would%20be%20greatly%20appreciated%20if%20you%20could%20send%20me%20an%20email%20using%20your%20personal%20email%20client%20rather%20than%20the%20current%20HTML%20popup%20one%2C%20as%20I%20may%20not%20receive%20your%20message.%0A%0AThank%20you."><i class="fas fa-envelope" style="font-size:16.75px"></i></a><a class="navbar-item navbar-item-logo" title="Gitter" target="_blank" rel="noopener" href="https://app.gitter.im/#/room/#Paddy/Community:gitter.im"><i class="fab fa-gitter" style="font-size:16.75px"></i></a><a class="navbar-item navbar-item-logo" title="Element" target="_blank" rel="noopener" href="https://app.element.io/#/room/#Paddy/Community:gitter.im"><svg version="1.0" id="svg-element" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 225 225"><g fill="#4a4a4a"><path d="M91 1c-11 3-13 19-3 24l11 2c32 3 56 27 59 59 0 9 2 12 6 15 7 4 15 2 19-5l1-13c-1-11-3-19-9-31A87 87 0 0 0 91 1zM73 43a90 90 0 0 0-72 91c3 11 19 13 24 3l2-11c3-32 27-56 59-59 9 0 12-2 15-6 4-7 2-15-5-19H73zM208 82c-7 2-9 6-10 17-3 32-27 56-59 59-9 0-12 2-15 6-4 7-1 15 5 19l13 1c12-1 20-3 33-9a86 86 0 0 0 49-84c-1-4-6-9-8-9h-8zM47 124c-5 3-6 7-6 18 1 12 3 20 10 33 13 28 39 46 71 49 10 1 14 0 18-3 6-6 4-17-3-21l-11-2c-32-3-56-27-59-59l-2-10c-2-4-7-7-11-7l-7 2z"></path></g></svg></a><a class="navbar-item navbar-item-logo" title="GitHub" target="_blank" rel="noopener" href="https://github.com/paddyzz"><i class="fab fa-github" style="font-size:16.75px"></i></a><a class="navbar-item navbar-item-logo" title="Linkedin" target="_blank" rel="noopener" href="https://www.linkedin.com/in/jiahe-paddy-zhao-213b24300"><i class="fab fa-linkedin" style="font-size:19.75px"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item navbar-item-logo search" title="Search For It !" href="javascript:;"><i class="fa-brands fa-searchengin" style="font-size:19.75px"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-3 is-size-4-mobile title-font-style">House Price Prediction</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item author-capitalize"> Paddy </span><span class="level-item"><i class="far fa-calendar-alt"></i>&nbsp;<time dateTime="2024-06-02T12:46:51.914Z" title="02/06/2024, 8:46:51 pm">02-06-2024</time></span><span class="level-item"><i class="far fa-calendar-check"></i>&nbsp;<time dateTime="2024-06-26T12:56:41.072Z" title="26/06/2024, 8:56:41 pm">26-06-2024</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i><span> </span><a class="link-muted" href="/projects/">projects</a></span><span class="level-item"> <i class="far fa-clock"></i> <span> </span> 26 minutes read<span> </span>( About 3865 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><article class="message is-info" style="margin-top:1.5rem;font-style:oblique"><div class="message-body">House Price Prediction</div></article><div class="content" style="margin-top:1.5rem;margin-bottom:1rem"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># The error metric: RMSE on the log of the sale prices.from sklearn.metrics import mean_squared_error</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rmse</span>(<span class="params">y_true, y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(mean_squared_error(y_true, y_pred))</span><br><span class="line"><span class="comment"># Load the data.train_df = pd.read_csv(&quot;/kaggle/input/house-price/train.csv&quot;)</span></span><br><span class="line">test_df = pd.read_csv(<span class="string">&quot;/kaggle/input/house-price/test.csv&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># There are a few houses with more than 4000 sq ft living area that are# outliers, so we drop them from the training data. (There is also one in# the test set but we obviously can&#x27;t drop that one.)train_df.drop(train_df[train_df[&quot;GrLivArea&quot;] &gt; 4000].index, inplace=True)</span></span><br><span class="line"><span class="comment"># The test example with ID 666 has GarageArea, GarageCars, and GarageType# but none of the other fields, so use the mode and median to fill them in.test_df.loc[666, &quot;GarageQual&quot;] = &quot;TA&quot;test_df.loc[666, &quot;GarageCond&quot;] = &quot;TA&quot;test_df.loc[666, &quot;GarageFinish&quot;] = &quot;Unf&quot;test_df.loc[666, &quot;GarageYrBlt&quot;] = &quot;1980&quot;# The test example 1116 only has GarageType but no other information. We&#x27;ll# assume it does not have a garage.test_df.loc[1116, &quot;GarageType&quot;] = np.nan</span></span><br><span class="line"><span class="comment"># For imputing missing values: fill in missing LotFrontage values by the median# LotFrontage of the neighborhood.lot_frontage_by_neighborhood = train_df[&quot;LotFrontage&quot;].groupby(train_df[&quot;Neighborhood&quot;])</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Used to convert categorical features into ordinal numbers.# (There&#x27;s probably an easier way to do this, but it works.)from sklearn.preprocessing import LabelEncoder</span></span><br><span class="line">le = LabelEncoder()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factorize</span>(<span class="params">df, factor_df, column, fill_na=<span class="literal">None</span></span>):</span><br><span class="line">    factor_df[column] = df[column]</span><br><span class="line">    <span class="keyword">if</span> fill_na <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        factor_df[column].fillna(fill_na, inplace=<span class="literal">True</span>)</span><br><span class="line">    le.fit(factor_df[column].unique())</span><br><span class="line">    factor_df[column] = le.transform(factor_df[column])</span><br><span class="line">    <span class="keyword">return</span> factor_df</span><br><span class="line"><span class="comment"># Combine all the (numerical) features into one big DataFrame. We don&#x27;t add# the one-hot encoded variables here yet, that happens later on.def munge(df):</span></span><br><span class="line">    all_df = pd.DataFrame(index = df.index)</span><br><span class="line">    all_df[<span class="string">&quot;LotFrontage&quot;</span>] = df[<span class="string">&quot;LotFrontage&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> key, group <span class="keyword">in</span> lot_frontage_by_neighborhood:</span><br><span class="line">        idx = (df[<span class="string">&quot;Neighborhood&quot;</span>] == key) &amp; (df[<span class="string">&quot;LotFrontage&quot;</span>].isnull())</span><br><span class="line">        all_df.loc[idx, <span class="string">&quot;LotFrontage&quot;</span>] = group.median()</span><br><span class="line">    all_df[<span class="string">&quot;LotArea&quot;</span>] = df[<span class="string">&quot;LotArea&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;MasVnrArea&quot;</span>] = df[<span class="string">&quot;MasVnrArea&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;MasVnrArea&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;BsmtFinSF1&quot;</span>] = df[<span class="string">&quot;BsmtFinSF1&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;BsmtFinSF1&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;BsmtFinSF2&quot;</span>] = df[<span class="string">&quot;BsmtFinSF2&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;BsmtFinSF2&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;BsmtUnfSF&quot;</span>] = df[<span class="string">&quot;BsmtUnfSF&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;BsmtUnfSF&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;TotalBsmtSF&quot;</span>] = df[<span class="string">&quot;TotalBsmtSF&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;TotalBsmtSF&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;1stFlrSF&quot;</span>] = df[<span class="string">&quot;1stFlrSF&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;2ndFlrSF&quot;</span>] = df[<span class="string">&quot;2ndFlrSF&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;GrLivArea&quot;</span>] = df[<span class="string">&quot;GrLivArea&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;GarageArea&quot;</span>] = df[<span class="string">&quot;GarageArea&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;GarageArea&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;WoodDeckSF&quot;</span>] = df[<span class="string">&quot;WoodDeckSF&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;OpenPorchSF&quot;</span>] = df[<span class="string">&quot;OpenPorchSF&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;EnclosedPorch&quot;</span>] = df[<span class="string">&quot;EnclosedPorch&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;3SsnPorch&quot;</span>] = df[<span class="string">&quot;3SsnPorch&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;ScreenPorch&quot;</span>] = df[<span class="string">&quot;ScreenPorch&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;BsmtFullBath&quot;</span>] = df[<span class="string">&quot;BsmtFullBath&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;BsmtFullBath&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;BsmtHalfBath&quot;</span>] = df[<span class="string">&quot;BsmtHalfBath&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;BsmtHalfBath&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;FullBath&quot;</span>] = df[<span class="string">&quot;FullBath&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;HalfBath&quot;</span>] = df[<span class="string">&quot;HalfBath&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;BedroomAbvGr&quot;</span>] = df[<span class="string">&quot;BedroomAbvGr&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;KitchenAbvGr&quot;</span>] = df[<span class="string">&quot;KitchenAbvGr&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;TotRmsAbvGrd&quot;</span>] = df[<span class="string">&quot;TotRmsAbvGrd&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;Fireplaces&quot;</span>] = df[<span class="string">&quot;Fireplaces&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;GarageCars&quot;</span>] = df[<span class="string">&quot;GarageCars&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;GarageCars&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;CentralAir&quot;</span>] = (df[<span class="string">&quot;CentralAir&quot;</span>] == <span class="string">&quot;Y&quot;</span>) * <span class="number">1.0</span>    all_df[<span class="string">&quot;OverallQual&quot;</span>] = df[<span class="string">&quot;OverallQual&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;OverallCond&quot;</span>] = df[<span class="string">&quot;OverallCond&quot;</span>]</span><br><span class="line">    <span class="comment"># Quality measurements are stored as text but we can convert them to    # numbers where a higher number means higher quality.    qual_dict = &#123;np.nan: 0, &quot;Po&quot;: 1, &quot;Fa&quot;: 2, &quot;TA&quot;: 3, &quot;Gd&quot;: 4, &quot;Ex&quot;: 5&#125;</span></span><br><span class="line">    all_df[<span class="string">&quot;ExterQual&quot;</span>] = df[<span class="string">&quot;ExterQual&quot;</span>].<span class="built_in">map</span>(qual_dict).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;ExterCond&quot;</span>] = df[<span class="string">&quot;ExterCond&quot;</span>].<span class="built_in">map</span>(qual_dict).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;BsmtQual&quot;</span>] = df[<span class="string">&quot;BsmtQual&quot;</span>].<span class="built_in">map</span>(qual_dict).astype(<span class="built_in">int</span>)<span class="comment">#    all_df[&quot;BsmtCond&quot;] = df[&quot;BsmtCond&quot;].map(qual_dict).astype(int)#    all_df[&quot;HeatingQC&quot;] = df[&quot;HeatingQC&quot;].map(qual_dict).astype(int)</span></span><br><span class="line">    all_df[<span class="string">&quot;KitchenQual&quot;</span>] = df[<span class="string">&quot;KitchenQual&quot;</span>].<span class="built_in">map</span>(qual_dict).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;FireplaceQu&quot;</span>] = df[<span class="string">&quot;FireplaceQu&quot;</span>].<span class="built_in">map</span>(qual_dict).astype(<span class="built_in">int</span>)<span class="comment">#    all_df[&quot;GarageQual&quot;] = df[&quot;GarageQual&quot;].map(qual_dict).astype(int)#    all_df[&quot;GarageCond&quot;] = df[&quot;GarageCond&quot;].map(qual_dict).astype(int)#    all_df[&quot;BsmtExposure&quot;] = df[&quot;BsmtExposure&quot;].map(</span></span><br><span class="line">        &#123;np.nan: <span class="number">0</span>, <span class="string">&quot;No&quot;</span>: <span class="number">1</span>, <span class="string">&quot;Mn&quot;</span>: <span class="number">2</span>, <span class="string">&quot;Av&quot;</span>: <span class="number">3</span>, <span class="string">&quot;Gd&quot;</span>: <span class="number">4</span>&#125;).astype(<span class="built_in">int</span>)</span><br><span class="line">    bsmt_fin_dict = &#123;np.nan: <span class="number">0</span>, <span class="string">&quot;Unf&quot;</span>: <span class="number">1</span>, <span class="string">&quot;LwQ&quot;</span>: <span class="number">2</span>, <span class="string">&quot;Rec&quot;</span>: <span class="number">3</span>, <span class="string">&quot;BLQ&quot;</span>: <span class="number">4</span>, <span class="string">&quot;ALQ&quot;</span>: <span class="number">5</span>, <span class="string">&quot;GLQ&quot;</span>: <span class="number">6</span>&#125;</span><br><span class="line">    all_df[<span class="string">&quot;BsmtFinType1&quot;</span>] = df[<span class="string">&quot;BsmtFinType1&quot;</span>].<span class="built_in">map</span>(bsmt_fin_dict).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;BsmtFinType2&quot;</span>] = df[<span class="string">&quot;BsmtFinType2&quot;</span>].<span class="built_in">map</span>(bsmt_fin_dict).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;Functional&quot;</span>] = df[<span class="string">&quot;Functional&quot;</span>].<span class="built_in">map</span>(</span><br><span class="line">        &#123;np.nan: <span class="number">0</span>, <span class="string">&quot;Sal&quot;</span>: <span class="number">1</span>, <span class="string">&quot;Sev&quot;</span>: <span class="number">2</span>, <span class="string">&quot;Maj2&quot;</span>: <span class="number">3</span>, <span class="string">&quot;Maj1&quot;</span>: <span class="number">4</span>,</span><br><span class="line">         <span class="string">&quot;Mod&quot;</span>: <span class="number">5</span>, <span class="string">&quot;Min2&quot;</span>: <span class="number">6</span>, <span class="string">&quot;Min1&quot;</span>: <span class="number">7</span>, <span class="string">&quot;Typ&quot;</span>: <span class="number">8</span>&#125;).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;GarageFinish&quot;</span>] = df[<span class="string">&quot;GarageFinish&quot;</span>].<span class="built_in">map</span>(</span><br><span class="line">        &#123;np.nan: <span class="number">0</span>, <span class="string">&quot;Unf&quot;</span>: <span class="number">1</span>, <span class="string">&quot;RFn&quot;</span>: <span class="number">2</span>, <span class="string">&quot;Fin&quot;</span>: <span class="number">3</span>&#125;).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;Fence&quot;</span>] = df[<span class="string">&quot;Fence&quot;</span>].<span class="built_in">map</span>(</span><br><span class="line">        &#123;np.nan: <span class="number">0</span>, <span class="string">&quot;MnWw&quot;</span>: <span class="number">1</span>, <span class="string">&quot;GdWo&quot;</span>: <span class="number">2</span>, <span class="string">&quot;MnPrv&quot;</span>: <span class="number">3</span>, <span class="string">&quot;GdPrv&quot;</span>: <span class="number">4</span>&#125;).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;YearBuilt&quot;</span>] = df[<span class="string">&quot;YearBuilt&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;YearRemodAdd&quot;</span>] = df[<span class="string">&quot;YearRemodAdd&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;GarageYrBlt&quot;</span>] = df[<span class="string">&quot;GarageYrBlt&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;GarageYrBlt&quot;</span>].fillna(<span class="number">0.0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;MoSold&quot;</span>] = df[<span class="string">&quot;MoSold&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;YrSold&quot;</span>] = df[<span class="string">&quot;YrSold&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;LowQualFinSF&quot;</span>] = df[<span class="string">&quot;LowQualFinSF&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;MiscVal&quot;</span>] = df[<span class="string">&quot;MiscVal&quot;</span>]</span><br><span class="line">   <span class="comment"># df[&quot;PoolQC&quot;].fillna(&quot;NA&quot;, inplace=True) #    all_df[&quot;PoolQC&quot;] = df[&quot;PoolQC&quot;].map(qual_dict).astype(int)#    all_df[&quot;PoolArea&quot;] = df[&quot;PoolArea&quot;]</span></span><br><span class="line">    all_df[<span class="string">&quot;PoolArea&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># Add categorical features as numbers too. It seems to help a bit.    all_df = factorize(df, all_df, &quot;MSSubClass&quot;)</span></span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;MSZoning&quot;</span>, <span class="string">&quot;RL&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;LotConfig&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;Neighborhood&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;Condition1&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;BldgType&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;HouseStyle&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;RoofStyle&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;Exterior1st&quot;</span>, <span class="string">&quot;Other&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;Exterior2nd&quot;</span>, <span class="string">&quot;Other&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;MasVnrType&quot;</span>, <span class="string">&quot;None&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;Foundation&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;SaleType&quot;</span>, <span class="string">&quot;Oth&quot;</span>)</span><br><span class="line">    all_df = factorize(df, all_df, <span class="string">&quot;SaleCondition&quot;</span>)</span><br><span class="line">    <span class="comment"># IR2 and IR3 don&#x27;t appear that often, so just make a distinction    # between regular and irregular.    all_df[&quot;IsRegularLotShape&quot;] = (df[&quot;LotShape&quot;] == &quot;Reg&quot;) * 1    # Most properties are level; bin the other possibilities together    # as &quot;not level&quot;.    all_df[&quot;IsLandLevel&quot;] = (df[&quot;LandContour&quot;] == &quot;Lvl&quot;) * 1    # Most land slopes are gentle; treat the others as &quot;not gentle&quot;.    all_df[&quot;IsLandSlopeGentle&quot;] = (df[&quot;LandSlope&quot;] == &quot;Gtl&quot;) * 1    # Most properties use standard circuit breakers.    all_df[&quot;IsElectricalSBrkr&quot;] = (df[&quot;Electrical&quot;] == &quot;SBrkr&quot;) * 1    # About 2/3rd have an attached garage.    all_df[&quot;IsGarageDetached&quot;] = (df[&quot;GarageType&quot;] == &quot;Detchd&quot;) * 1    # Most have a paved drive. Treat dirt/gravel and partial pavement    # as &quot;not paved&quot;.    all_df[&quot;IsPavedDrive&quot;] = (df[&quot;PavedDrive&quot;] == &quot;Y&quot;) * 1    # The only interesting &quot;misc. feature&quot; is the presence of a shed.    all_df[&quot;HasShed&quot;] = (df[&quot;MiscFeature&quot;] == &quot;Shed&quot;) * 1.</span></span><br><span class="line">    <span class="comment"># If YearRemodAdd != YearBuilt, then a remodeling took place at some point.    all_df[&quot;Remodeled&quot;] = (all_df[&quot;YearRemodAdd&quot;] != all_df[&quot;YearBuilt&quot;]) * 1    # Did a remodeling happen in the year the house was sold?    all_df[&quot;RecentRemodel&quot;] = (all_df[&quot;YearRemodAdd&quot;] == all_df[&quot;YrSold&quot;]) * 1    # Was this house sold in the year it was built?    all_df[&quot;VeryNewHouse&quot;] = (all_df[&quot;YearBuilt&quot;] == all_df[&quot;YrSold&quot;]) * 1    all_df[&quot;Has2ndFloor&quot;] = (all_df[&quot;2ndFlrSF&quot;] == 0) * 1    all_df[&quot;HasMasVnr&quot;] = (all_df[&quot;MasVnrArea&quot;] == 0) * 1    all_df[&quot;HasWoodDeck&quot;] = (all_df[&quot;WoodDeckSF&quot;] == 0) * 1    all_df[&quot;HasOpenPorch&quot;] = (all_df[&quot;OpenPorchSF&quot;] == 0) * 1    all_df[&quot;HasEnclosedPorch&quot;] = (all_df[&quot;EnclosedPorch&quot;] == 0) * 1    all_df[&quot;Has3SsnPorch&quot;] = (all_df[&quot;3SsnPorch&quot;] == 0) * 1    all_df[&quot;HasScreenPorch&quot;] = (all_df[&quot;ScreenPorch&quot;] == 0) * 1    # Months with the largest number of deals may be significant.    all_df[&quot;HighSeason&quot;] = df[&quot;MoSold&quot;].replace(</span></span><br><span class="line">        &#123;<span class="number">1</span>: <span class="number">0</span>, <span class="number">2</span>: <span class="number">0</span>, <span class="number">3</span>: <span class="number">0</span>, <span class="number">4</span>: <span class="number">1</span>, <span class="number">5</span>: <span class="number">1</span>, <span class="number">6</span>: <span class="number">1</span>, <span class="number">7</span>: <span class="number">1</span>, <span class="number">8</span>: <span class="number">0</span>, <span class="number">9</span>: <span class="number">0</span>, <span class="number">10</span>: <span class="number">0</span>, <span class="number">11</span>: <span class="number">0</span>, <span class="number">12</span>: <span class="number">0</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;NewerDwelling&quot;</span>] = df[<span class="string">&quot;MSSubClass&quot;</span>].replace(</span><br><span class="line">        &#123;<span class="number">20</span>: <span class="number">1</span>, <span class="number">30</span>: <span class="number">0</span>, <span class="number">40</span>: <span class="number">0</span>, <span class="number">45</span>: <span class="number">0</span>,<span class="number">50</span>: <span class="number">0</span>, <span class="number">60</span>: <span class="number">1</span>, <span class="number">70</span>: <span class="number">0</span>, <span class="number">75</span>: <span class="number">0</span>, <span class="number">80</span>: <span class="number">0</span>, <span class="number">85</span>: <span class="number">0</span>,</span><br><span class="line">         <span class="number">90</span>: <span class="number">0</span>, <span class="number">120</span>: <span class="number">1</span>, <span class="number">150</span>: <span class="number">0</span>, <span class="number">160</span>: <span class="number">0</span>, <span class="number">180</span>: <span class="number">0</span>, <span class="number">190</span>: <span class="number">0</span>&#125;)</span><br><span class="line">    all_df.loc[df.Neighborhood == <span class="string">&#x27;NridgHt&#x27;</span>, <span class="string">&quot;Neighborhood_Good&quot;</span>] = <span class="number">1</span>    all_df.loc[df.Neighborhood == <span class="string">&#x27;Crawfor&#x27;</span>, <span class="string">&quot;Neighborhood_Good&quot;</span>] = <span class="number">1</span>    all_df.loc[df.Neighborhood == <span class="string">&#x27;StoneBr&#x27;</span>, <span class="string">&quot;Neighborhood_Good&quot;</span>] = <span class="number">1</span>    all_df.loc[df.Neighborhood == <span class="string">&#x27;Somerst&#x27;</span>, <span class="string">&quot;Neighborhood_Good&quot;</span>] = <span class="number">1</span>    all_df.loc[df.Neighborhood == <span class="string">&#x27;NoRidge&#x27;</span>, <span class="string">&quot;Neighborhood_Good&quot;</span>] = <span class="number">1</span>    all_df[<span class="string">&quot;Neighborhood_Good&quot;</span>].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    all_df[<span class="string">&quot;SaleCondition_PriceDown&quot;</span>] = df.SaleCondition.replace(</span><br><span class="line">        &#123;<span class="string">&#x27;Abnorml&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;Alloca&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;AdjLand&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;Family&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;Normal&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;Partial&#x27;</span>: <span class="number">0</span>&#125;)</span><br><span class="line">    <span class="comment"># House completed before sale or not    all_df[&quot;BoughtOffPlan&quot;] = df.SaleCondition.replace(</span></span><br><span class="line">        &#123;<span class="string">&quot;Abnorml&quot;</span> : <span class="number">0</span>, <span class="string">&quot;Alloca&quot;</span> : <span class="number">0</span>, <span class="string">&quot;AdjLand&quot;</span> : <span class="number">0</span>, <span class="string">&quot;Family&quot;</span> : <span class="number">0</span>, <span class="string">&quot;Normal&quot;</span> : <span class="number">0</span>, <span class="string">&quot;Partial&quot;</span> : <span class="number">1</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;BadHeating&quot;</span>] = df.HeatingQC.replace(</span><br><span class="line">        &#123;<span class="string">&#x27;Ex&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;Gd&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;TA&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;Fa&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;Po&#x27;</span>: <span class="number">1</span>&#125;)</span><br><span class="line">    area_cols = [<span class="string">&#x27;LotFrontage&#x27;</span>, <span class="string">&#x27;LotArea&#x27;</span>, <span class="string">&#x27;MasVnrArea&#x27;</span>, <span class="string">&#x27;BsmtFinSF1&#x27;</span>, <span class="string">&#x27;BsmtFinSF2&#x27;</span>, <span class="string">&#x27;BsmtUnfSF&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;TotalBsmtSF&#x27;</span>, <span class="string">&#x27;1stFlrSF&#x27;</span>, <span class="string">&#x27;2ndFlrSF&#x27;</span>, <span class="string">&#x27;GrLivArea&#x27;</span>, <span class="string">&#x27;GarageArea&#x27;</span>, <span class="string">&#x27;WoodDeckSF&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;OpenPorchSF&#x27;</span>, <span class="string">&#x27;EnclosedPorch&#x27;</span>, <span class="string">&#x27;3SsnPorch&#x27;</span>, <span class="string">&#x27;ScreenPorch&#x27;</span>, <span class="string">&#x27;LowQualFinSF&#x27;</span>, <span class="string">&#x27;PoolArea&#x27;</span> ]</span><br><span class="line">    all_df[<span class="string">&quot;TotalArea&quot;</span>] = all_df[area_cols].<span class="built_in">sum</span>(axis=<span class="number">1</span>)</span><br><span class="line">    all_df[<span class="string">&quot;TotalArea1st2nd&quot;</span>] = all_df[<span class="string">&quot;1stFlrSF&quot;</span>] + all_df[<span class="string">&quot;2ndFlrSF&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;Age&quot;</span>] = <span class="number">2010</span> - all_df[<span class="string">&quot;YearBuilt&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;TimeSinceSold&quot;</span>] = <span class="number">2010</span> - all_df[<span class="string">&quot;YrSold&quot;</span>]</span><br><span class="line">    all_df[<span class="string">&quot;SeasonSold&quot;</span>] = all_df[<span class="string">&quot;MoSold&quot;</span>].<span class="built_in">map</span>(&#123;<span class="number">12</span>:<span class="number">0</span>, <span class="number">1</span>:<span class="number">0</span>, <span class="number">2</span>:<span class="number">0</span>, <span class="number">3</span>:<span class="number">1</span>, <span class="number">4</span>:<span class="number">1</span>, <span class="number">5</span>:<span class="number">1</span>,</span><br><span class="line">                                                  <span class="number">6</span>:<span class="number">2</span>, <span class="number">7</span>:<span class="number">2</span>, <span class="number">8</span>:<span class="number">2</span>, <span class="number">9</span>:<span class="number">3</span>, <span class="number">10</span>:<span class="number">3</span>, <span class="number">11</span>:<span class="number">3</span>&#125;).astype(<span class="built_in">int</span>)</span><br><span class="line">    all_df[<span class="string">&quot;YearsSinceRemodel&quot;</span>] = all_df[<span class="string">&quot;YrSold&quot;</span>] - all_df[<span class="string">&quot;YearRemodAdd&quot;</span>]</span><br><span class="line">    <span class="comment"># Simplifications of existing features into bad/average/good.    all_df[&quot;SimplOverallQual&quot;] = all_df.OverallQual.replace(</span></span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>, <span class="number">6</span> : <span class="number">2</span>, <span class="number">7</span> : <span class="number">3</span>, <span class="number">8</span> : <span class="number">3</span>, <span class="number">9</span> : <span class="number">3</span>, <span class="number">10</span> : <span class="number">3</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplOverallCond&quot;</span>] = all_df.OverallCond.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>, <span class="number">6</span> : <span class="number">2</span>, <span class="number">7</span> : <span class="number">3</span>, <span class="number">8</span> : <span class="number">3</span>, <span class="number">9</span> : <span class="number">3</span>, <span class="number">10</span> : <span class="number">3</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplPoolQC&quot;</span>] = all_df.PoolQC.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">2</span>, <span class="number">4</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplGarageCond&quot;</span>] = all_df.GarageCond.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplGarageQual&quot;</span>] = all_df.GarageQual.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplFireplaceQu&quot;</span>] = all_df.FireplaceQu.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplFireplaceQu&quot;</span>] = all_df.FireplaceQu.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplFunctional&quot;</span>] = all_df.Functional.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">2</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">3</span>, <span class="number">6</span> : <span class="number">3</span>, <span class="number">7</span> : <span class="number">3</span>, <span class="number">8</span> : <span class="number">4</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplKitchenQual&quot;</span>] = all_df.KitchenQual.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplHeatingQC&quot;</span>] = all_df.HeatingQC.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplBsmtFinType1&quot;</span>] = all_df.BsmtFinType1.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>, <span class="number">6</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplBsmtFinType2&quot;</span>] = all_df.BsmtFinType2.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>, <span class="number">6</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplBsmtCond&quot;</span>] = all_df.BsmtCond.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplBsmtQual&quot;</span>] = all_df.BsmtQual.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplExterCond&quot;</span>] = all_df.ExterCond.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    all_df[<span class="string">&quot;SimplExterQual&quot;</span>] = all_df.ExterQual.replace(</span><br><span class="line">        &#123;<span class="number">1</span> : <span class="number">1</span>, <span class="number">2</span> : <span class="number">1</span>, <span class="number">3</span> : <span class="number">1</span>, <span class="number">4</span> : <span class="number">2</span>, <span class="number">5</span> : <span class="number">2</span>&#125;)</span><br><span class="line">    <span class="comment"># Bin by neighborhood (a little arbitrarily). Values were computed by:    # train_df[&quot;SalePrice&quot;].groupby(train_df[&quot;Neighborhood&quot;]).median().sort_values()    neighborhood_map = &#123;</span></span><br><span class="line">        <span class="string">&quot;MeadowV&quot;</span> : <span class="number">0</span>,  <span class="comment">#  88000        &quot;IDOTRR&quot; : 1,   # 103000        &quot;BrDale&quot; : 1,   # 106000        &quot;OldTown&quot; : 1,  # 119000        &quot;Edwards&quot; : 1,  # 119500        &quot;BrkSide&quot; : 1,  # 124300        &quot;Sawyer&quot; : 1,   # 135000        &quot;Blueste&quot; : 1,  # 137500        &quot;SWISU&quot; : 2,    # 139500        &quot;NAmes&quot; : 2,    # 140000        &quot;NPkVill&quot; : 2,  # 146000        &quot;Mitchel&quot; : 2,  # 153500        &quot;SawyerW&quot; : 2,  # 179900        &quot;Gilbert&quot; : 2,  # 181000        &quot;NWAmes&quot; : 2,   # 182900        &quot;Blmngtn&quot; : 2,  # 191000        &quot;CollgCr&quot; : 2,  # 197200        &quot;ClearCr&quot; : 3,  # 200250        &quot;Crawfor&quot; : 3,  # 200624        &quot;Veenker&quot; : 3,  # 218000        &quot;Somerst&quot; : 3,  # 225500        &quot;Timber&quot; : 3,   # 228475        &quot;StoneBr&quot; : 4,  # 278000        &quot;NoRidge&quot; : 4,  # 290000        &quot;NridgHt&quot; : 4,  # 315000    &#125;</span></span><br><span class="line">    all_df[<span class="string">&quot;NeighborhoodBin&quot;</span>] = df[<span class="string">&quot;Neighborhood&quot;</span>].<span class="built_in">map</span>(neighborhood_map)</span><br><span class="line">    <span class="keyword">return</span> all_df</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">train_df_munged = munge(train_df)</span><br><span class="line">test_df_munged = munge(test_df)</span><br><span class="line"><span class="built_in">print</span>(train_df_munged.shape)</span><br><span class="line"><span class="built_in">print</span>(test_df_munged.shape)</span><br><span class="line"><span class="comment"># Copy NeighborhoodBin into a temporary DataFrame because we want to use the# unscaled version later on (to one-hot encode it).neighborhood_bin_train = pd.DataFrame(index = train_df.index)</span></span><br><span class="line">neighborhood_bin_train[<span class="string">&quot;NeighborhoodBin&quot;</span>] = train_df_munged[<span class="string">&quot;NeighborhoodBin&quot;</span>]</span><br><span class="line">neighborhood_bin_test = pd.DataFrame(index = test_df.index)</span><br><span class="line">neighborhood_bin_test[<span class="string">&quot;NeighborhoodBin&quot;</span>] = test_df_munged[<span class="string">&quot;NeighborhoodBin&quot;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(1456, 111)</span><br><span class="line">(1459, 111)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">numeric_features = train_df_munged.dtypes[train_df_munged.dtypes != <span class="string">&quot;object&quot;</span>].index</span><br><span class="line"><span class="comment"># Transform the skewed numeric features by taking log(feature + 1).# This will make the features more normal.from scipy.stats import skew</span></span><br><span class="line">skewed = train_df_munged[numeric_features].apply(<span class="keyword">lambda</span> x: skew(x.dropna().astype(<span class="built_in">float</span>)))</span><br><span class="line">skewed = skewed[skewed &gt; <span class="number">0.75</span>]</span><br><span class="line">skewed = skewed.index</span><br><span class="line">train_df_munged[skewed] = np.log1p(train_df_munged[skewed])</span><br><span class="line">test_df_munged[skewed] = np.log1p(test_df_munged[skewed])</span><br><span class="line"><span class="comment"># Additional processing: scale the data.from sklearn.preprocessing import StandardScaler</span></span><br><span class="line">scaler = StandardScaler()</span><br><span class="line">scaler.fit(train_df_munged[numeric_features])</span><br><span class="line">scaled = scaler.transform(train_df_munged[numeric_features])</span><br><span class="line"><span class="keyword">for</span> i, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(numeric_features):</span><br><span class="line">    train_df_munged[col] = scaled[:, i]</span><br><span class="line">scaled = scaler.transform(test_df_munged[numeric_features])</span><br><span class="line"><span class="keyword">for</span> i, col <span class="keyword">in</span> <span class="built_in">enumerate</span>(numeric_features):</span><br><span class="line">    test_df_munged[col] = scaled[:, i]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Convert categorical features using one-hot encoding.def onehot(onehot_df, df, column_name, fill_na, drop_name):</span></span><br><span class="line">    onehot_df[column_name] = df[column_name]</span><br><span class="line">    <span class="keyword">if</span> fill_na <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        onehot_df[column_name].fillna(fill_na, inplace=<span class="literal">True</span>)</span><br><span class="line">    dummies = pd.get_dummies(onehot_df[column_name], prefix=<span class="string">&quot;_&quot;</span> + column_name)</span><br><span class="line">    <span class="comment"># Dropping one of the columns actually made the results slightly worse.    # if drop_name is not None:    #     dummies.drop([&quot;_&quot; + column_name + &quot;_&quot; + drop_name], axis=1, inplace=True)    onehot_df = onehot_df.join(dummies)</span></span><br><span class="line">    onehot_df = onehot_df.drop([column_name], axis=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> onehot_df</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">munge_onehot</span>(<span class="params">df</span>):</span><br><span class="line">    onehot_df = pd.DataFrame(index = df.index)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;MSSubClass&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;40&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;MSZoning&quot;</span>, <span class="string">&quot;RL&quot;</span>, <span class="string">&quot;RH&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;LotConfig&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;FR3&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Neighborhood&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;OldTown&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Condition1&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;RRNe&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;BldgType&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;2fmCon&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;HouseStyle&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;1.5Unf&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;RoofStyle&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;Shed&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Exterior1st&quot;</span>, <span class="string">&quot;VinylSd&quot;</span>, <span class="string">&quot;CBlock&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Exterior2nd&quot;</span>, <span class="string">&quot;VinylSd&quot;</span>, <span class="string">&quot;CBlock&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Foundation&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;Wood&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;SaleType&quot;</span>, <span class="string">&quot;WD&quot;</span>, <span class="string">&quot;Oth&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;SaleCondition&quot;</span>, <span class="string">&quot;Normal&quot;</span>, <span class="string">&quot;AdjLand&quot;</span>)</span><br><span class="line">    <span class="comment"># Fill in missing MasVnrType for rows that do have a MasVnrArea.    temp_df = df[[&quot;MasVnrType&quot;, &quot;MasVnrArea&quot;]].copy()</span></span><br><span class="line">    idx = (df[<span class="string">&quot;MasVnrArea&quot;</span>] != <span class="number">0</span>) &amp; ((df[<span class="string">&quot;MasVnrType&quot;</span>] == <span class="string">&quot;None&quot;</span>) | (df[<span class="string">&quot;MasVnrType&quot;</span>].isnull()))</span><br><span class="line">    temp_df.loc[idx, <span class="string">&quot;MasVnrType&quot;</span>] = <span class="string">&quot;BrkFace&quot;</span>    onehot_df = onehot(onehot_df, temp_df, <span class="string">&quot;MasVnrType&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;BrkCmn&quot;</span>)</span><br><span class="line">    <span class="comment"># Also add the booleans from calc_df as dummy variables.    onehot_df = onehot(onehot_df, df, &quot;LotShape&quot;, None, &quot;IR3&quot;)</span></span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;LandContour&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;Low&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;LandSlope&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;Sev&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Electrical&quot;</span>, <span class="string">&quot;SBrkr&quot;</span>, <span class="string">&quot;FuseP&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;GarageType&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;CarPort&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;PavedDrive&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;P&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;MiscFeature&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Othr&quot;</span>)</span><br><span class="line">    <span class="comment"># Features we can probably ignore (but want to include anyway to see    # if they make any positive difference).    # Definitely ignoring Utilities: all records are &quot;AllPub&quot;, except for    # one &quot;NoSeWa&quot; in the train set and 2 NA in the test set.    onehot_df = onehot(onehot_df, df, &quot;Street&quot;, None, &quot;Grvl&quot;)</span></span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Alley&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Grvl&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Condition2&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;PosA&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;RoofMatl&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;WdShake&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Heating&quot;</span>, <span class="literal">None</span>, <span class="string">&quot;Wall&quot;</span>)</span><br><span class="line">    <span class="comment"># I have these as numerical variables too.    onehot_df = onehot(onehot_df, df, &quot;ExterQual&quot;, &quot;None&quot;, &quot;Ex&quot;)</span></span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;ExterCond&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;BsmtQual&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;BsmtCond&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;HeatingQC&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;KitchenQual&quot;</span>, <span class="string">&quot;TA&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;FireplaceQu&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;GarageQual&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;GarageCond&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;PoolQC&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Ex&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;BsmtExposure&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Gd&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;BsmtFinType1&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;GLQ&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;BsmtFinType2&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;GLQ&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Functional&quot;</span>, <span class="string">&quot;Typ&quot;</span>, <span class="string">&quot;Typ&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;GarageFinish&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;Fin&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;Fence&quot;</span>, <span class="string">&quot;None&quot;</span>, <span class="string">&quot;MnPrv&quot;</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, df, <span class="string">&quot;MoSold&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="comment"># Divide up the years between 1871 and 2010 in slices of 20 years.    year_map = pd.concat(pd.Series(&quot;YearBin&quot; + str(i+1), index=range(1871+i*20,1891+i*20)) for i in range(0, 7))</span></span><br><span class="line">    yearbin_df = pd.DataFrame(index = df.index)</span><br><span class="line">    yearbin_df[<span class="string">&quot;GarageYrBltBin&quot;</span>] = df.GarageYrBlt.<span class="built_in">map</span>(year_map)</span><br><span class="line">    yearbin_df[<span class="string">&quot;GarageYrBltBin&quot;</span>].fillna(<span class="string">&quot;NoGarage&quot;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    yearbin_df[<span class="string">&quot;YearBuiltBin&quot;</span>] = df.YearBuilt.<span class="built_in">map</span>(year_map)</span><br><span class="line">    yearbin_df[<span class="string">&quot;YearRemodAddBin&quot;</span>] = df.YearRemodAdd.<span class="built_in">map</span>(year_map)</span><br><span class="line">    onehot_df = onehot(onehot_df, yearbin_df, <span class="string">&quot;GarageYrBltBin&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, yearbin_df, <span class="string">&quot;YearBuiltBin&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">    onehot_df = onehot(onehot_df, yearbin_df, <span class="string">&quot;YearRemodAddBin&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> onehot_df</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add the one-hot encoded categorical features.onehot_df = munge_onehot(train_df)</span></span><br><span class="line">onehot_df = onehot(onehot_df, neighborhood_bin_train, <span class="string">&quot;NeighborhoodBin&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">train_df_munged = train_df_munged.join(onehot_df)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># These onehot columns are missing in the test data, so drop them from the# training data or we might overfit on them.drop_cols = [</span></span><br><span class="line">                <span class="string">&quot;_Exterior1st_ImStucc&quot;</span>, <span class="string">&quot;_Exterior1st_Stone&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_Exterior2nd_Other&quot;</span>,<span class="string">&quot;_HouseStyle_2.5Fin&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_RoofMatl_Membran&quot;</span>, <span class="string">&quot;_RoofMatl_Metal&quot;</span>, <span class="string">&quot;_RoofMatl_Roll&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_Condition2_RRAe&quot;</span>, <span class="string">&quot;_Condition2_RRAn&quot;</span>, <span class="string">&quot;_Condition2_RRNn&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_Heating_Floor&quot;</span>, <span class="string">&quot;_Heating_OthW&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_Electrical_Mix&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_MiscFeature_TenC&quot;</span>,</span><br><span class="line">                <span class="string">&quot;_GarageQual_Ex&quot;</span>, <span class="string">&quot;_PoolQC_Fa&quot;</span>            ]</span><br><span class="line">train_df_munged.drop(drop_cols, axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">onehot_df = munge_onehot(test_df)</span><br><span class="line">onehot_df = onehot(onehot_df, neighborhood_bin_test, <span class="string">&quot;NeighborhoodBin&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">test_df_munged = test_df_munged.join(onehot_df)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This column is missing in the training data. There is only one example with# this value in the test set. So just drop it.test_df_munged.drop([&quot;_MSSubClass_150&quot;], axis=1, inplace=True)</span></span><br><span class="line"><span class="comment"># Drop these columns. They are either not very helpful or they cause overfitting.drop_cols = [</span></span><br><span class="line">    <span class="string">&quot;_Condition2_PosN&quot;</span>,    <span class="comment"># only two are not zero    &quot;_MSZoning_C (all)&quot;,</span></span><br><span class="line">    <span class="string">&quot;_MSSubClass_160&quot;</span>,</span><br><span class="line">]</span><br><span class="line">train_df_munged.drop(drop_cols, axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">test_df_munged.drop(drop_cols, axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># We take the log here because the error metric is between the log of the# SalePrice and the log of the predicted price. That does mean we need to# exp() the prediction to get an actual sale price.label_df = pd.DataFrame(index = train_df_munged.index, columns=[&quot;SalePrice&quot;])</span></span><br><span class="line">label_df[<span class="string">&quot;SalePrice&quot;</span>] = np.log(train_df[<span class="string">&quot;SalePrice&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Training set size:&quot;</span>, train_df_munged.shape)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Test set size:&quot;</span>, test_df_munged.shape)</span><br><span class="line">y_train = label_df[<span class="string">&quot;SalePrice&quot;</span>].values</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Training set size: (1456, 403)</span><br><span class="line">Test set size: (1459, 403)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################################################################################################################################################################################################################################</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#print(&quot;Training set size:&quot;, train_df_munged.shape)#print(&quot;Test set size:&quot;, test_df_munged.shape)y_train = label_df[&quot;SalePrice&quot;].values</span></span><br><span class="line"><span class="comment">#train_df_munged.values</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> ElasticNet, Lasso,  BayesianRidge, LassoLarsIC ,Ridge</span><br><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestRegressor,  GradientBoostingRegressor</span><br><span class="line"><span class="keyword">from</span> sklearn.kernel_ridge <span class="keyword">import</span> KernelRidge</span><br><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> make_pipeline</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> RobustScaler</span><br><span class="line"><span class="keyword">from</span> sklearn.base <span class="keyword">import</span> BaseEstimator, TransformerMixin, RegressorMixin, clone</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> KFold, cross_val_score, train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> mean_squared_error</span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</span><br><span class="line"><span class="keyword">import</span> lightgbm <span class="keyword">as</span> lgb</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Validation functionn_folds = 5def rmsle_cv(model):</span></span><br><span class="line">    kf = KFold(n_folds, shuffle=<span class="literal">True</span>, random_state=<span class="number">42</span>).get_n_splits(train_df_munged.values)</span><br><span class="line">    rmse= np.sqrt(-cross_val_score(model, train_df_munged.values, y_train, scoring=<span class="string">&quot;neg_mean_squared_error&quot;</span>, cv = kf))</span><br><span class="line">    <span class="keyword">return</span>(rmse)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lasso = make_pipeline(RobustScaler(), Lasso(alpha =<span class="number">0.0005</span>, random_state=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ridge = make_pipeline(RobustScaler(), Ridge(alpha =<span class="number">0.0005</span>, random_state=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENet = make_pipeline(RobustScaler(), ElasticNet(alpha=<span class="number">0.0005</span>, l1_ratio=<span class="number">.9</span>, random_state=<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KRR = KernelRidge(alpha=<span class="number">0.6</span>, kernel=<span class="string">&#x27;polynomial&#x27;</span>, degree=<span class="number">2</span>, coef0=<span class="number">2.5</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GBoost = GradientBoostingRegressor(n_estimators=<span class="number">3000</span>, learning_rate=<span class="number">0.05</span>,</span><br><span class="line">                                   max_depth=<span class="number">4</span>, max_features=<span class="string">&#x27;sqrt&#x27;</span>,</span><br><span class="line">                                   min_samples_leaf=<span class="number">15</span>, min_samples_split=<span class="number">10</span>,</span><br><span class="line">                                   loss=<span class="string">&#x27;huber&#x27;</span>, random_state =<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">model_xgb = xgb.XGBRegressor(colsample_bytree=<span class="number">0.4603</span>, gamma=<span class="number">0.0468</span>,</span><br><span class="line">                             learning_rate=<span class="number">0.05</span>, max_depth=<span class="number">3</span>,</span><br><span class="line">                             min_child_weight=<span class="number">1.7817</span>, n_estimators=<span class="number">2200</span>,</span><br><span class="line">                             reg_alpha=<span class="number">0.4640</span>, reg_lambda=<span class="number">0.8571</span>,</span><br><span class="line">                             subsample=<span class="number">0.5213</span>, silent=<span class="number">1</span>,</span><br><span class="line">                             random_state =<span class="number">7</span>, nthread = -<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">model_lgb = lgb.LGBMRegressor(objective=<span class="string">&#x27;regression&#x27;</span>,num_leaves=<span class="number">5</span>,</span><br><span class="line">                              learning_rate=<span class="number">0.05</span>, n_estimators=<span class="number">720</span>,</span><br><span class="line">                              max_bin = <span class="number">55</span>, bagging_fraction = <span class="number">0.8</span>,</span><br><span class="line">                              bagging_freq = <span class="number">5</span>, feature_fraction = <span class="number">0.2319</span>,</span><br><span class="line">                              feature_fraction_seed=<span class="number">9</span>, bagging_seed=<span class="number">9</span>,</span><br><span class="line">                              min_data_in_leaf =<span class="number">6</span>, min_sum_hessian_in_leaf = <span class="number">11</span>,</span><br><span class="line">                             verbose = <span class="string">&#x27;-1&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">score = rmsle_cv(lasso)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nLasso score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Lasso score: 0.1101 (0.0056)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">score = rmsle_cv(ridge)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nRidge score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ridge score: 0.1744 (0.0794)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">score = rmsle_cv(ENet)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ElasticNet score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ElasticNet score: 0.1101 (0.0057)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">score = rmsle_cv(KRR)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Kernel Ridge score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kernel Ridge score: 0.1100 (0.0053)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">score = rmsle_cv(GBoost)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Gradient Boosting score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Gradient Boosting score: 0.1146 (0.0070)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">score = rmsle_cv(model_xgb)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Xgboost score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Xgboost score: 0.1138 (0.0060)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">score = rmsle_cv(model_lgb)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;LGBM score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span> .<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LGBM score: 0.1151 (0.0052)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AveragingModels</span>(BaseEstimator, RegressorMixin, TransformerMixin):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, models</span>):</span><br><span class="line">        self.models = models</span><br><span class="line">    <span class="comment"># we define clones of the original models to fit the data in    def fit(self, X, y):</span></span><br><span class="line">        self.models_ = [clone(x) <span class="keyword">for</span> x <span class="keyword">in</span> self.models]</span><br><span class="line">        <span class="comment"># Train cloned base models        for model in self.models_:</span></span><br><span class="line">            model.fit(X, y)</span><br><span class="line">        <span class="keyword">return</span> self    <span class="comment">#Now we do the predictions for cloned models and average them    def predict(self, X):</span></span><br><span class="line">        predictions = np.column_stack([</span><br><span class="line">            model.predict(X) <span class="keyword">for</span> model <span class="keyword">in</span> self.models_</span><br><span class="line">        ])</span><br><span class="line">        <span class="keyword">return</span> np.mean(predictions, axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">averaged_models = AveragingModels(models = (ENet, GBoost, KRR, lasso))</span><br><span class="line">score = rmsle_cv(averaged_models)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot; Averaged base models score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Averaged base models score: 0.1077 (0.0057)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">averaged_models_ridge = AveragingModels(models = (ENet, GBoost, KRR, ridge))</span><br><span class="line">score = rmsle_cv(averaged_models_ridge)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot; Averaged base models score: &#123;:.4f&#125; (&#123;:.4f&#125;)\n&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Averaged base models score: 0.1155 (0.0115)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StackingAveragedModels</span>(BaseEstimator, RegressorMixin, TransformerMixin):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_models, meta_model, n_folds=<span class="number">5</span></span>):</span><br><span class="line">        self.base_models = base_models</span><br><span class="line">        self.meta_model = meta_model</span><br><span class="line">        self.n_folds = n_folds</span><br><span class="line">    <span class="comment"># We again fit the data on clones of the original models    def fit(self, X, y):</span></span><br><span class="line">        self.base_models_ = [<span class="built_in">list</span>() <span class="keyword">for</span> x <span class="keyword">in</span> self.base_models]</span><br><span class="line">        self.meta_model_ = clone(self.meta_model)</span><br><span class="line">        kfold = KFold(n_splits=self.n_folds, shuffle=<span class="literal">True</span>, random_state=<span class="number">156</span>)</span><br><span class="line">        <span class="comment"># Train cloned base models then create out-of-fold predictions        # that are needed to train the cloned meta-model        out_of_fold_predictions = np.zeros((X.shape[0], len(self.base_models)))</span></span><br><span class="line">        <span class="keyword">for</span> i, model <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.base_models):</span><br><span class="line">            <span class="keyword">for</span> train_index, holdout_index <span class="keyword">in</span> kfold.split(X, y):</span><br><span class="line">                instance = clone(model)</span><br><span class="line">                self.base_models_[i].append(instance)</span><br><span class="line">                instance.fit(X[train_index], y[train_index])</span><br><span class="line">                y_pred = instance.predict(X[holdout_index])</span><br><span class="line">                out_of_fold_predictions[holdout_index, i] = y_pred</span><br><span class="line">        <span class="comment"># Now train the cloned  meta-model using the out-of-fold predictions as new feature        self.meta_model_.fit(out_of_fold_predictions, y)</span></span><br><span class="line">        <span class="keyword">return</span> self    <span class="comment">#Do the predictions of all base models on the test data and use the averaged predictions as    #meta-features for the final prediction which is done by the meta-model    def predict(self, X):</span></span><br><span class="line">        meta_features = np.column_stack([</span><br><span class="line">            np.column_stack([model.predict(X) <span class="keyword">for</span> model <span class="keyword">in</span> base_models]).mean(axis=<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">for</span> base_models <span class="keyword">in</span> self.base_models_ ])</span><br><span class="line">        <span class="keyword">return</span> self.meta_model_.predict(meta_features)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stacked_averaged_models = StackingAveragedModels(base_models = (ENet, GBoost, KRR),</span><br><span class="line">                                                 meta_model = lasso)</span><br><span class="line">score = rmsle_cv(stacked_averaged_models)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Stacking Averaged models score: &#123;:.4f&#125; (&#123;:.4f&#125;)&quot;</span>.<span class="built_in">format</span>(score.mean(), score.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stacking Averaged models score: 0.1079 (0.0054)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stacked_averaged_models_ridge = StackingAveragedModels(base_models = (ENet, GBoost, KRR),</span><br><span class="line">                                                 meta_model = ridge)</span><br><span class="line">score_ridge = rmsle_cv(stacked_averaged_models_ridge)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Stacking Averaged models score: &#123;:.4f&#125; (&#123;:.4f&#125;)&quot;</span>.<span class="built_in">format</span>(score_ridge.mean(), score_ridge.std()))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Stacking Averaged models score: 0.1079 (0.0054)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rmsle</span>(<span class="params">y, y_pred</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(mean_squared_error(y, y_pred))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stacked_averaged_models.fit(train_df_munged.values, y_train)</span><br><span class="line">stacked_train_pred = stacked_averaged_models.predict(train_df_munged.values)</span><br><span class="line">stacked_pred = np.expm1(stacked_averaged_models.predict(test_df_munged.values))</span><br><span class="line"><span class="built_in">print</span>(rmsle(y_train, stacked_train_pred))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.07384935969780994</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stacked_averaged_models_ridge.fit(train_df_munged.values, y_train)</span><br><span class="line">stacked_train_pred_ridge = stacked_averaged_models_ridge.predict(train_df_munged.values)</span><br><span class="line">stacked_pred_ridge = np.expm1(stacked_averaged_models_ridge.predict(test_df_munged.values))</span><br><span class="line"><span class="built_in">print</span>(rmsle(y_train, stacked_train_pred_ridge))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.07386785761731066</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">model_xgb.fit(train_df_munged, y_train)</span><br><span class="line">xgb_train_pred = model_xgb.predict(train_df_munged)</span><br><span class="line">xgb_pred = np.expm1(model_xgb.predict(test_df_munged))</span><br><span class="line"><span class="built_in">print</span>(rmsle(y_train, xgb_train_pred))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.08404240349359858</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">model_lgb.fit(train_df_munged, y_train)</span><br><span class="line">lgb_train_pred = model_lgb.predict(train_df_munged)</span><br><span class="line">lgb_pred = np.expm1(model_lgb.predict(test_df_munged.values))</span><br><span class="line"><span class="built_in">print</span>(rmsle(y_train, lgb_train_pred))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.06926259332568477</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;RMSE on the entire Train data when averaging&#x27;&#x27;&#x27;</span><span class="built_in">print</span>(<span class="string">&#x27;RMSLE score on train data:&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(rmsle(y_train,stacked_train_pred*<span class="number">0.7</span> +               xgb_train_pred*<span class="number">0.15</span> + lgb_train_pred*<span class="number">0.15</span>))  <span class="comment">#0.75 0.125 0.125</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RMSLE score on train data:</span><br><span class="line">0.07282898327817613</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;RMSE on the entire Train data when averaging&#x27;&#x27;&#x27;</span><span class="built_in">print</span>(<span class="string">&#x27;RMSLE_ridge score on train data:&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(rmsle(y_train,stacked_train_pred_ridge*<span class="number">0.7</span> +               xgb_train_pred*<span class="number">0.15</span> + lgb_train_pred*<span class="number">0.15</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RMSLE_ridge score on train data:</span><br><span class="line">0.0728370672457598</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ensemble = stacked_pred*<span class="number">0.85</span> + xgb_pred*<span class="number">0.075</span> + lgb_pred*<span class="number">0.075</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ensemble_ridge = stacked_pred_ridge*<span class="number">0.75</span> + xgb_pred*<span class="number">0.125</span> + lgb_pred*<span class="number">0.125</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sub = pd.DataFrame()</span><br><span class="line">test_ID = test_df[<span class="string">&#x27;Id&#x27;</span>]</span><br><span class="line">sub[<span class="string">&#x27;Id&#x27;</span>] = test_ID</span><br><span class="line">sub[<span class="string">&#x27;SalePrice&#x27;</span>] = ensemble_ridge</span><br><span class="line">sub.to_csv(<span class="string">&#x27;submission.csv&#x27;</span>,index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure></div><div class="article-licensing box"><div class="licensing-title"><p>House Price Prediction</p><p><a class="link-muted" href="http://paddyzz.github.io/projects/House_Price_Prediction/">http://paddyzz.github.io/projects/House_Price_Prediction/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Paddy</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>02-06-2024</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>26-06-2024</p></div></div><div class="level-item is-narrow"><div><h6>Categories</h6><a class="link-muted is-uppercase is-size-7 article_license_category" href="/projects/">projects</a></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons article_license_logo" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons article_license_logo" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons article_license_logo" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 mb-4" style="line-height:21px;height:0"><i class="fas fa-tags has-text-grey"></i><span> </span><a class="link-muted  tag-uppercase" rel="tag" href="/tags/PROJECTS/">PROJECTS</a></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=665ef533f75dab0019ade953&amp;&amp;product=inline-share-buttons" defer></script></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/life/"><span class="level-item">life_test_one</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://paddyzz.github.io/projects/House_Price_Prediction/';
            this.page.identifier = '/projects/House_Price_Prediction/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'paddys-disqus' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div> </div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://assets-global.website-files.com/653dcbdd718cbd5c51c4dbed/653f5e8549a0fbf7dc295818_IMG_20190205_193746-p-500.jpg" alt="Jiahe(Paddy) ZHAO"></figure><p class="title is-size-4 is-block" style="line-height:inherit;margin-bottom:0.5rem;">Jiahe(Paddy) ZHAO</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Artificial Intelligence</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Machine Learning</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Deep Learning</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Computer Science</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Information Technology</p><p class="is-size-6 is-flex justify-content-center" style="margin-top:0.5rem;"><i class="fas fa-map-marker-alt mr-1"></i><span>Hebei, CHINA</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading widget-profile-article-fontsize-style title-font-style">Posts</p><a href="/archives"><p class="title widget-profile-number-style">10</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading widget-profile-article-fontsize-style title-font-style">Categories</p><a href="/categories"><p class="title widget-profile-number-style">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading widget-profile-article-fontsize-style title-font-style">Tags</p><a href="/tags"><p class="title widget-profile-number-style">8</p></a></div></div></nav><div class="level"><a class="level-item fake-button-style is-rounded widget-profile-follow-button-style title-font-style" href="mailto:jiahe.zhao@uq.net.au?body=Hello%2C%0A%0AIt%20would%20be%20greatly%20appreciated%20if%20you%20could%20send%20me%20an%20email%20using%20your%20personal%20email%20client%20rather%20than%20the%20current%20HTML%20popup%20one%2C%20as%20I%20may%20not%20receive%20your%20message.%0A%0AThank%20you." target="_blank" rel="noopener"> <i class="fa fa-envelope" style="font-size:16.75px;margin-right:0.6rem;"></i>Email Me</a><span>  </span><a class="level-item fake-button-style is-rounded widget-profile-follow-button-style title-font-style" href="https://www.linkedin.com/in/jiahe-paddy-zhao-213b24300" target="_blank" rel="noopener"> <i class="fa-brands fa-linkedin color-linkedin" style="font-size:16.75px;margin-right:0.6rem;"></i>LinkedIn</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="Github" href="https://github.com/paddyzz"><i class="fa-brands fa-github color-github"></i></a><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="Kaggle" href="https://www.kaggle.com/paddyzhao/"><i class="fa-brands fa-kaggle color-kaggle"></i></a><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/profile.php?id=100087961621533"><i class="fa-brands fa-facebook color-facebook"></i></a><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="X" href="https://x.com/paddyzhao150568"><i class="fa-brands fa-x-twitter color-X"></i></a><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="Discord" href="https://discord.com/users/1001308889062576139"><i class="fa-brands fa-discord color-discord"></i></a></div></div></div><!--!--><!--!--><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer" style="padding:2rem 0.75rem 2rem;"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/favicon.png" alt="Paddy - Paddy&#039;s Log Book" height="28"></a><p class="is-size-7"><span>&copy; 2023-2024 Paddy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a> &amp; <a href="/" target="_blank" rel="noopener">Paddy&#039;s FE Tech</a><br><span id="busuanzi_container_page_uv">Visited by <span id="busuanzi_value_page_uv">88</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent article_license_logo is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent article_license_logo is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent article_license_logo is-large" target="_blank" rel="noopener" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/universe.js"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script type="text/javascript" src="/js/gsap_progressbar.js"></script><script type="text/javascript" src="/js/night.js"></script></body></html>