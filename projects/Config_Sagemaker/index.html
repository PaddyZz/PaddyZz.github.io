<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Configure and deploy models on Sagemaker - Paddy - Paddy&#039;s Log Book</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Paddy - Paddy&#039;s Log Book"><meta name="msapplication-TileImage" content="/images/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Paddy - Paddy&#039;s Log Book"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Deploy the VGG19 model to AWS sagemaker and make inference"><meta property="og:type" content="blog"><meta property="og:title" content="Configure and deploy models on Sagemaker"><meta property="og:url" content="http://paddyzz.github.io/projects/Config_Sagemaker/"><meta property="og:site_name" content="Paddy - Paddy&#039;s Log Book"><meta property="og:description" content="Deploy the VGG19 model to AWS sagemaker and make inference"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://paddyzz.github.io/images/assets/config_sagemaker/image.png"><meta property="article:published_time" content="2024-07-30T16:00:00.000Z"><meta property="article:modified_time" content="2024-10-23T16:00:00.000Z"><meta property="article:author" content="Paddy"><meta property="article:tag" content="DL"><meta property="article:tag" content="ML"><meta property="article:tag" content="PROJECTS"><meta property="article:tag" content="CICD"><meta property="article:tag" content="AWS"><meta property="article:tag" content="Docker"><meta property="article:tag" content="End-to-End"><meta property="article:tag" content="MLOps"><meta property="article:tag" content="Python"><meta property="article:tag" content="ECR"><meta property="article:tag" content="S3"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://paddyzz.github.io/images/assets/config_sagemaker/image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://paddyzz.github.io/projects/Config_Sagemaker/"},"headline":"Configure and deploy models on Sagemaker","image":["http://paddyzz.github.io/images/assets/config_sagemaker/image.png"],"datePublished":"2024-07-30T16:00:00.000Z","dateModified":"2024-10-23T16:00:00.000Z","author":{"@type":"Person","name":"Paddy"},"publisher":{"@type":"Organization","name":"Paddy - Paddy's Log Book","logo":{"@type":"ImageObject","url":"http://paddyzz.github.io/images/favicon.png"}},"description":"Deploy the VGG19 model to AWS sagemaker and make inference"}</script><link rel="canonical" href="http://paddyzz.github.io/projects/Config_Sagemaker/"><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><meta name="follow.it-verification-code" content="SdbKP9l6XayZRBYCuvDS"><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><script type="text/javascript" src="/js/svg-inject.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gsap@3.3.4/dist/gsap.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gsap@3.3.4/dist/ScrollTrigger.js"></script><progress max="100" value="0"></progress><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/favicon.png" alt="Paddy - Paddy&#039;s Log Book" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item navbar-item-home" href="/">PADDY&#039;S LOG BOOK</a><a class="navbar-item" href="/curriculum/">CURRICULUM</a><a class="navbar-item" href="/certificates/">CERTIFICATES</a><a class="navbar-item" href="/blogs/">BLOGS</a><a class="navbar-item" href="/projects/">PROJECTS</a><a class="navbar-item" href="/life/">LIFE</a><a class="navbar-item" href="/archives/">ARCHIVES</a><a class="navbar-item" href="/categories/">CATEGORIES</a><a class="navbar-item" href="/tags/">TAGS</a><a class="navbar-item" href="/faqs/">FAQS</a></div><div class="navbar-end"><a class="navbar-item navbar-item-logo" id="star-nav" title="Nox Tenebratio!" style="opacity:0;display:none;userSelect:none;" href="javascript:;"><i class="fa fa-star-and-crescent" id="star-icon" style="font-size:17.75px"></i></a><a class="navbar-item navbar-item-logo night" id="night-nav" title="Nox!" href="javascript:;"><i class="fas fa-moon" id="night-icon" style="font-size:16.75px"></i></a><a class="navbar-item navbar-item-logo" id="night-nav" title="Email" href="mailto:jiahe.zhao@uq.net.au?body=Hello%2C%0A%0AIt%20would%20be%20greatly%20appreciated%20if%20you%20could%20send%20me%20an%20email%20using%20your%20personal%20email%20client%20rather%20than%20the%20current%20HTML%20popup%20one%2C%20as%20I%20may%20not%20receive%20your%20message.%0A%0AThank%20you."><i class="fas fa-envelope" style="font-size:16.75px"></i></a><a class="navbar-item navbar-item-logo" title="Gitter" target="_blank" rel="noopener" href="https://app.gitter.im/#/room/#Paddy/Community:gitter.im"><i class="fab fa-gitter" style="font-size:16.75px"></i></a><a class="navbar-item navbar-item-logo" title="Element" target="_blank" rel="noopener" href="https://app.element.io/#/room/#Paddy/Community:gitter.im"><svg version="1.0" id="svg-element" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 225 225"><g fill="#4a4a4a"><path d="M91 1c-11 3-13 19-3 24l11 2c32 3 56 27 59 59 0 9 2 12 6 15 7 4 15 2 19-5l1-13c-1-11-3-19-9-31A87 87 0 0 0 91 1zM73 43a90 90 0 0 0-72 91c3 11 19 13 24 3l2-11c3-32 27-56 59-59 9 0 12-2 15-6 4-7 2-15-5-19H73zM208 82c-7 2-9 6-10 17-3 32-27 56-59 59-9 0-12 2-15 6-4 7-1 15 5 19l13 1c12-1 20-3 33-9a86 86 0 0 0 49-84c-1-4-6-9-8-9h-8zM47 124c-5 3-6 7-6 18 1 12 3 20 10 33 13 28 39 46 71 49 10 1 14 0 18-3 6-6 4-17-3-21l-11-2c-32-3-56-27-59-59l-2-10c-2-4-7-7-11-7l-7 2z"></path></g></svg></a><a class="navbar-item navbar-item-logo" title="GitHub" target="_blank" rel="noopener" href="https://github.com/paddyzz"><i class="fab fa-github" style="font-size:16.75px"></i></a><a class="navbar-item navbar-item-logo" title="Linkedin" target="_blank" rel="noopener" href="https://www.linkedin.com/in/jiahe-paddy-zhao-213b24300"><i class="fab fa-linkedin" style="font-size:19.75px"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item navbar-item-logo search" title="Search For It !" href="javascript:;"><i class="fa-brands fa-searchengin" style="font-size:19.75px"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-3 is-size-4-mobile title-font-style">Configure and deploy models on Sagemaker</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item author-capitalize"> Paddy </span><span class="level-item"><i class="far fa-calendar-alt"></i>&nbsp;<time dateTime="2024-07-30T16:00:00.000Z" title="31/07/2024, 12:00:00 am">31-07-2024</time></span><span class="level-item"><i class="far fa-calendar-check"></i>&nbsp;<time dateTime="2024-10-23T16:00:00.000Z" title="24/10/2024, 12:00:00 am">24-10-2024</time></span><span class="level-item"><i class="far fa-folder-open has-text-grey"></i><span> </span><a class="link-muted" href="/projects/">projects</a></span><span class="level-item"> <i class="far fa-clock"></i> <span> </span> 9 minutes read<span> </span>( About 1295 words)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><article class="message is-info" style="margin-top:1.5rem;font-style:oblique"><div class="message-body">Deploy the VGG19 model to AWS sagemaker and make inference</div></article><div class="content card-content-font-style" style="margin-top:1.5rem;margin-bottom:1rem"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>AWS SageMaker is an excellent ML platform for conducting MLOps, simplifying model deployment, seamlessly integrating with other AWS services, and enabling rapid iteration and experimentation. In this blog post, we’ll delve into the process of deploying a VGG19 model to AWS SageMaker, covering the steps involved in training the model, creating a SageMaker endpoint, and making real-time inferences.</p>
<h2 id="Get-the-model"><a href="#Get-the-model" class="headerlink" title="Get the model"></a>Get the model</h2><p>the model have been trained and saved on &#x2F;home&#x2F;sagemaker-user&#x2F;model&#x2F;vgg19&#x2F;model_file,</p>
<p>see the <a target="_blank" rel="noopener" href="https://github.com/PaddyZz/Neural-style-transfer">blog</a> for more info</p>
<h2 id="Make-the-inference-py"><a href="#Make-the-inference-py" class="headerlink" title="Make the inference.py"></a>Make the inference.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">model_fn</span>(<span class="params">model_dir</span>):</span><br><span class="line">    model = tf.saved_model.load(model_dir)</span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">predict_fn</span>(<span class="params">input_data, model</span>):</span><br><span class="line">    outputs = model(input_data)</span><br><span class="line">    <span class="keyword">return</span> outputs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">input_fn</span>(<span class="params">request_body, request_content_type=<span class="string">&#x27;application/json&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> request_content_type == <span class="string">&#x27;application/json&#x27;</span>:</span><br><span class="line">        <span class="comment"># Parse the image URL or Base64 data from the request body</span></span><br><span class="line">        data = json.loads(request_body)</span><br><span class="line">        image_data = data[<span class="string">&#x27;image&#x27;</span>]  <span class="comment"># Assume the JSON contains an &#x27;image&#x27; key</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># If it&#x27;s a URL, download the image</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;http&#x27;</span> <span class="keyword">in</span> image_data:</span><br><span class="line">            image = Image.<span class="built_in">open</span>(requests.get(image_data, stream=<span class="literal">True</span>).raw)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># If it&#x27;s Base64 encoded, decode it</span></span><br><span class="line">            image = Image.<span class="built_in">open</span>(io.BytesIO(base64.b64decode(image_data)))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Convert to a format suitable for model input</span></span><br><span class="line">        image = image.resize((<span class="number">224</span>, <span class="number">224</span>))  <span class="comment"># Assume VGG19 input size is 224x224</span></span><br><span class="line">        image = np.array(image) / <span class="number">255.0</span>  <span class="comment"># Normalize to [0, 1]</span></span><br><span class="line">        image = np.expand_dims(image, axis=<span class="number">0</span>)  <span class="comment"># Add batch dimension</span></span><br><span class="line">        <span class="keyword">return</span> tf.convert_to_tensor(image, dtype=tf.float32)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Unsupported content type: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(request_content_type))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">output_fn</span>(<span class="params">prediction, response_content_type=<span class="string">&#x27;application/json&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> response_content_type == <span class="string">&#x27;application/json&#x27;</span>:</span><br><span class="line">       </span><br><span class="line">        style_output = &#123;k: v.numpy().tolist() <span class="keyword">for</span> k, v <span class="keyword">in</span> prediction[<span class="string">&#x27;style&#x27;</span>].items()&#125;</span><br><span class="line">        content_output = &#123;k: v.numpy().tolist() <span class="keyword">for</span> k, v <span class="keyword">in</span> prediction[<span class="string">&#x27;content&#x27;</span>].items()&#125;</span><br><span class="line">        result = &#123;</span><br><span class="line">            <span class="string">&#x27;style&#x27;</span>: style_output,</span><br><span class="line">            <span class="string">&#x27;content&#x27;</span>: content_output</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> json.dumps(result)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Unsupported content type: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(response_content_type)) </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -czvf model_package.tar.gz /home/sagemaker-user/model/vgg19/model_file inference.py</span><br></pre></td></tr></table></figure>

<h2 id="Upload-model-to-S3"><a href="#Upload-model-to-S3" class="headerlink" title="Upload model to S3"></a>Upload model to S3</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"></span><br><span class="line">s3_client = boto3.client(<span class="string">&#x27;s3&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bucket_name = <span class="string">&#x27;bucket-name&#x27;</span></span><br><span class="line">s3_file_path = <span class="string">&#x27;path/to/model_package.tar.gz&#x27;</span></span><br><span class="line">local_file_path = <span class="string">&#x27;model_package.tar.gz&#x27;</span>  </span><br><span class="line">s3_client.upload_file(local_file_path, bucket_name, s3_file_path)</span><br></pre></td></tr></table></figure>

<h2 id="Upload-a-custom-Docker-image-to-AWS-ECR"><a href="#Upload-a-custom-Docker-image-to-AWS-ECR" class="headerlink" title="Upload a custom Docker image to AWS ECR"></a><strong>Upload a custom Docker image to AWS ECR</strong></h2><h3 id="authenticating-to-the-AWS-ECR-repo"><a href="#authenticating-to-the-AWS-ECR-repo" class="headerlink" title="authenticating to the AWS ECR repo"></a>authenticating to the AWS ECR repo</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">REGION=&lt;my_aws_region&gt;</span><br><span class="line">ACCOUNT=&lt;my_aws_account&gt;</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Authenticate Docker to an AWS ECR registry</span></span><br><span class="line">aws ecr get-login-password --region $REGION | docker login --username AWS --password-stdin &lt;docker_registry_url&gt;.dkr.ecr.$REGION.amazonaws.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Loging to your private AWS ECR registry</span></span><br><span class="line">aws ecr get-login-password --region $REGION | docker login --username AWS --password-stdin $ACCOUNT.dkr.ecr.$REGION.amazonaws.com</span><br></pre></td></tr></table></figure>

<h3 id="Generate-requirements-txt-for-model-dependency"><a href="#Generate-requirements-txt-for-model-dependency" class="headerlink" title="Generate requirements.txt for model dependency"></a>Generate requirements.txt for model dependency</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">packages = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">IPython</span></span><br><span class="line"><span class="string">numpy</span></span><br><span class="line"><span class="string">Pillow</span></span><br><span class="line"><span class="string">tensorflow</span></span><br><span class="line"><span class="string">matplotlib</span></span><br><span class="line"><span class="string">requests</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/home/sagemaker-user/model/vgg19/requirements.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(packages.strip())</span><br></pre></td></tr></table></figure>

<h3 id="Make-dockerfile"><a href="#Make-dockerfile" class="headerlink" title="Make dockerfile"></a>Make dockerfile</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  Use the SageMaker Tensorflow image as the base image</span></span><br><span class="line"><span class="comment"># 763104351884.dkr.ecr.us-east-1.amazonaws.com/tensorflow-inference:2.0.0-gpu-py310 </span></span><br><span class="line"><span class="comment"># region: us-east-1 for reference</span></span><br><span class="line">FROM &lt;docker_registry_url&gt;.dkr.ecr.&lt;my_aws_region&gt;.amazonaws.com/tensorflow-inference:<span class="number">2.0</span><span class="number">.0</span>-gpu-py310</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the additional dependency</span></span><br><span class="line">RUN pip install /home/sagemaker-user/model/vgg19/requirements.txt</span><br></pre></td></tr></table></figure>

<h3 id="Build-and-push-image-file"><a href="#Build-and-push-image-file" class="headerlink" title="Build and push image file"></a>Build and push image file</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker build -t vgg19-image .</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the AWS ECR repository</span></span><br><span class="line">aws ecr create-repository --repository-name vgg19-image</span><br><span class="line"></span><br><span class="line"><span class="comment"># Tag the image</span></span><br><span class="line">docker tag vgg19-image:latest $ACCOUNT.dkr.ecr.$REGION.amazonaws.com/vgg19-image:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># Push the tagged image to the AWS ECR repository</span></span><br><span class="line">docker push $ACCOUNT.dkr.ecr.$REGION.amazonaws.com/vgg19-image:latest</span><br></pre></td></tr></table></figure>

<h2 id="Create-a-model-in-sagemaker"><a href="#Create-a-model-in-sagemaker" class="headerlink" title="Create a model in sagemaker"></a>Create a model in sagemaker</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"><span class="keyword">import</span> sagemaker</span><br><span class="line"></span><br><span class="line">sagemaker_client = boto3.client(service_name=<span class="string">&quot;sagemaker&quot;</span>)</span><br><span class="line">role = sagemaker.get_execution_role()</span><br><span class="line"></span><br><span class="line">model_name = <span class="string">&quot;&lt;model-name&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">primary_container = &#123;</span><br><span class="line">    <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;inference-image&quot;</span></span><br><span class="line">    <span class="string">&quot;ModelDataUrl&quot;</span>: <span class="string">&quot;s3://&lt;model-path&gt;.tar.gz&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">create_model_response = sagemaker_client.create_model(</span><br><span class="line">    ModelName=model_name,</span><br><span class="line">    ExecutionRoleArn=role,</span><br><span class="line">    PrimaryContainer=primary_container)</span><br></pre></td></tr></table></figure>

<h2 id="Create-an-Endpoint"><a href="#Create-an-Endpoint" class="headerlink" title="Create an Endpoint"></a>Create an Endpoint</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">endpoint_config_name = <span class="string">&quot;endpoint-config-name&quot;</span></span><br><span class="line"></span><br><span class="line">sagemaker_client.create_endpoint_config(</span><br><span class="line">    EndpointConfigName=endpoint_config_name,</span><br><span class="line">    ProductionVariants=[&#123;</span><br><span class="line">        <span class="string">&quot;InstanceType&quot;</span>: <span class="string">&quot;ml.g5.xlarge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;InitialVariantWeight&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;InitialInstanceCount&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&quot;ModelName&quot;</span>: model_name,</span><br><span class="line">        <span class="string">&quot;VariantName&quot;</span>: <span class="string">&quot;AllTraffic&quot;</span>&#125;])</span><br></pre></td></tr></table></figure>

<h2 id="Check-the-endpoint-status-if-it-is-in-service"><a href="#Check-the-endpoint-status-if-it-is-in-service" class="headerlink" title="Check the endpoint status if it is in-service"></a>Check the endpoint status if it is in-service</h2><p>we can start to invoke the endpoint to test it once the endpoint status is in-service</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    response = sagemaker_client.describe_endpoint(EndpointName=<span class="string">&#x27;endpoint-name&#x27;</span>)</span><br><span class="line">    status = response[<span class="string">&#x27;EndpointStatus&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Endpoint status: <span class="subst">&#123;status&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> status <span class="keyword">in</span> [<span class="string">&#x27;InService&#x27;</span>, <span class="string">&#x27;Failed&#x27;</span>]:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    time.sleep(<span class="number">30</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Invoke-the-endpoint"><a href="#Invoke-the-endpoint" class="headerlink" title="Invoke the endpoint"></a>Invoke the endpoint</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    payload = f.read()</span><br><span class="line"></span><br><span class="line">sagemaker_runtime = boto3.client(<span class="string">&quot;runtime.sagemaker&quot;</span>)</span><br><span class="line">response = sagemaker_runtime.invoke_endpoint(</span><br><span class="line">    EndpointName=endpoint_name,</span><br><span class="line">    ContentType=<span class="string">&quot;image/x-image&quot;</span>,</span><br><span class="line">    Body=payload</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">image_data = response[<span class="string">&quot;Body&quot;</span>].read()</span><br><span class="line">image = Image.<span class="built_in">open</span>(io.BytesIO(image_data))</span><br><span class="line">image.show()</span><br></pre></td></tr></table></figure>

<figcaption align="center">
  <img src="../../images/assets/config_sagemaker/image.png" >
</figcaption>

<h2 id="Review-and-potential-improvements"><a href="#Review-and-potential-improvements" class="headerlink" title="Review and potential improvements:"></a>Review and potential improvements:</h2><p>on making <strong>inference.py</strong> part, the ways of defining model_fn and predict_fn are a little bit simple and lack of flexibility.</p>
<p>Here is an good template of model_fn about setting up pretrain_model, loading configs, model_weights，joblib storage banks and transforms on enhancing performance, efficiency, and usability in machine learning workflows.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">model_fn</span>(<span class="params">model_dir</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    This function is the first to get executed upon a prediction request,</span></span><br><span class="line"><span class="string">    it loads the model from the disk and returns the model object which will be used later for inference.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load the config file</span></span><br><span class="line">    config = OmegaConf.load(os.path.join(model_dir, <span class="string">&quot;ai_vad_config.yaml&quot;</span>))</span><br><span class="line">    config_model = config.model</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load the model</span></span><br><span class="line">    model = AiVadModel(</span><br><span class="line">            box_score_thresh=config_model.box_score_thresh,</span><br><span class="line">            persons_only=config_model.persons_only,</span><br><span class="line">            min_bbox_area=config_model.min_bbox_area,</span><br><span class="line">            max_bbox_overlap=config_model.max_bbox_overlap,</span><br><span class="line">            enable_foreground_detections=config_model.enable_foreground_detections,</span><br><span class="line">            foreground_kernel_size=config_model.foreground_kernel_size,</span><br><span class="line">            foreground_binary_threshold=config_model.foreground_binary_threshold,</span><br><span class="line">            n_velocity_bins=config_model.n_velocity_bins,</span><br><span class="line">            use_velocity_features=config_model.use_velocity_features,</span><br><span class="line">            use_pose_features=config_model.use_pose_features,</span><br><span class="line">            use_deep_features=config_model.use_deep_features,</span><br><span class="line">            n_components_velocity=config_model.n_components_velocity,</span><br><span class="line">            n_neighbors_pose=config_model.n_neighbors_pose,</span><br><span class="line">            n_neighbors_deep=config_model.n_neighbors_deep,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load the model weights</span></span><br><span class="line">    model.load_state_dict(torch.load(os.path.join(model_dir, <span class="string">&quot;ai_vad_weights.pth&quot;</span>), map_location=device), strict=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Load the memory banks</span></span><br><span class="line">    velocity_estimator_memory_bank, pose_estimator_memory_bank, appearance_estimator_memory_bank = joblib.load(os.path.join(model_dir, <span class="string">&quot;ai_vad_banks.joblib&quot;</span>)) </span><br><span class="line">    <span class="keyword">if</span> velocity_estimator_memory_bank <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        model.density_estimator.velocity_estimator.memory_bank = velocity_estimator_memory_bank</span><br><span class="line">    <span class="keyword">if</span> pose_estimator_memory_bank <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        model.density_estimator.pose_estimator.memory_bank = pose_estimator_memory_bank</span><br><span class="line">    <span class="keyword">if</span> appearance_estimator_memory_bank <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        model.density_estimator.appearance_estimator.memory_bank = appearance_estimator_memory_bank</span><br><span class="line">    model.density_estimator.fit()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Move the entire model to device</span></span><br><span class="line">    model = model.to(device)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get the transforms</span></span><br><span class="line">    transform_config = config.dataset.transform_config.<span class="built_in">eval</span> <span class="keyword">if</span> <span class="string">&quot;transform_config&quot;</span> <span class="keyword">in</span> config.dataset.keys() <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">    image_size = (config.dataset.image_size[<span class="number">0</span>], config.dataset.image_size[<span class="number">1</span>])</span><br><span class="line">    center_crop = config.dataset.get(<span class="string">&quot;center_crop&quot;</span>)</span><br><span class="line">    center_crop = <span class="built_in">tuple</span>(center_crop) <span class="keyword">if</span> center_crop <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">    normalization = InputNormalizationMethod(config.dataset.normalization)</span><br><span class="line">    transform = get_transforms(config=transform_config, image_size=image_size, center_crop=center_crop, normalization=normalization)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model, transform</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>We have finished: </p>
<p>• Write the Sagemaker model serving script(inference.py)<br>• Upload the Model to S3<br>• Upload a custom Docker image to AWS ECR<br>• Create a Model in SageMaker<br>• Create an Endpoint Configuration<br>• Create an Endpoint<br>• Invoke the Endpoint</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a target="_blank" rel="noopener" href="https://towardsdatascience.com/deploy-a-custom-ml-model-as-a-sagemaker-endpoint-6d2540226428">Deploy a custom ml model on AWS sagemaker</a></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Configure and deploy models on Sagemaker</p><p><a class="link-muted" href="http://paddyzz.github.io/projects/Config_Sagemaker/">http://paddyzz.github.io/projects/Config_Sagemaker/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Paddy</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>31-07-2024</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>24-10-2024</p></div></div><div class="level-item is-narrow"><div><h6>Categories</h6><a class="link-muted is-uppercase is-size-7 article_license_category" href="/projects/">projects</a></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons article_license_logo" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons article_license_logo" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons article_license_logo" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1.5px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 mb-4" style="line-height:21px;height:0"><i class="fas fa-tags has-text-grey"></i><span> </span><a class="link-muted  tag-uppercase" rel="tag" href="/tags/DL/">DL<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/ML/">ML<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/PROJECTS/">PROJECTS<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/CICD/">CICD<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/AWS/">AWS<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/Docker/">Docker<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/End-to-End/">End-to-End<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/MLOps/">MLOps<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/Python/">Python<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/ECR/">ECR<span>, </span></a><a class="link-muted  tag-uppercase" rel="tag" href="/tags/S3/">S3</a></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=665ef533f75dab0019ade953&amp;&amp;product=inline-share-buttons" defer></script></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/projects/time_series_forecasting/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Time Series Forecasting</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/projects/neural_style_transfer/"><span class="level-item">Neural style transfer</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://paddyzz.github.io/projects/Config_Sagemaker/';
            this.page.identifier = '/projects/Config_Sagemaker/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'paddys-disqus' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div> </div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://assets-global.website-files.com/653dcbdd718cbd5c51c4dbed/653f5e8549a0fbf7dc295818_IMG_20190205_193746-p-500.jpg" alt="Jiahe(Paddy) ZHAO"></figure><p class="title is-size-4 is-block" style="line-height:inherit;margin-bottom:0.5rem;">Jiahe(Paddy) ZHAO</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Artificial Intelligence</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Machine Learning</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Deep Learning</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Computer Science</p><p class="is-block" style="font-style:Italic;font-size:0.8rem;">Information Technology</p><p class="is-size-6 is-flex justify-content-center" style="margin-top:0.5rem;"><i class="fas fa-map-marker-alt mr-1"></i><span>Hebei, CHINA</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading widget-profile-article-fontsize-style title-font-style">Posts</p><a href="/archives"><p class="title widget-profile-number-style">14</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading widget-profile-article-fontsize-style title-font-style">Categories</p><a href="/categories"><p class="title widget-profile-number-style">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading widget-profile-article-fontsize-style title-font-style">Tags</p><a href="/tags"><p class="title widget-profile-number-style">62</p></a></div></div></nav><div class="level"><a class="level-item fake-button-style is-rounded widget-profile-follow-button-style title-font-style" href="mailto:jiahe.zhao@uq.net.au?body=Hello%2C%0A%0AIt%20would%20be%20greatly%20appreciated%20if%20you%20could%20send%20me%20an%20email%20using%20your%20personal%20email%20client%20rather%20than%20the%20current%20HTML%20popup%20one%2C%20as%20I%20may%20not%20receive%20your%20message.%0A%0AThank%20you." target="_blank" rel="noopener"> <i class="fa fa-envelope" style="font-size:16.75px;margin-right:0.6rem;"></i>Email Me</a><span>  </span><a class="level-item fake-button-style is-rounded widget-profile-follow-button-style title-font-style" href="https://www.linkedin.com/in/jiahe-paddy-zhao-213b24300" target="_blank" rel="noopener"> <i class="fa-brands fa-linkedin color-linkedin" style="font-size:16.75px;margin-right:0.6rem;"></i>LinkedIn</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="Github" href="https://github.com/paddyzz"><i class="fa-brands fa-github color-github"></i></a><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="Kaggle" href="https://www.kaggle.com/paddyzhao/"><i class="fa-brands fa-kaggle color-kaggle"></i></a><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="Facebook" href="https://www.facebook.com/profile.php?id=100087961621533"><i class="fa-brands fa-facebook-f color-facebook"></i></a><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="X" href="https://x.com/paddyzhao150568"><i class="fa-brands fa-x-twitter color-X"></i></a><a class="level-item button is-transparent is-marginless widget-profile-logo-style" target="_blank" rel="noopener" title="Discord" href="https://discord.com/users/1001308889062576139"><i class="fa-brands fa-discord color-discord"></i></a></div></div></div><div class="card widget is-sticky" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Introduction"><span class="level-left"><span class="level-item">1</span><span class="level-item">Introduction</span></span></a></li><li><a class="level is-mobile" href="#Get-the-model"><span class="level-left"><span class="level-item">2</span><span class="level-item">Get the model</span></span></a></li><li><a class="level is-mobile" href="#Make-the-inference-py"><span class="level-left"><span class="level-item">3</span><span class="level-item">Make the inference.py</span></span></a></li><li><a class="level is-mobile" href="#Upload-model-to-S3"><span class="level-left"><span class="level-item">4</span><span class="level-item">Upload model to S3</span></span></a></li><li><a class="level is-mobile" href="#Upload-a-custom-Docker-image-to-AWS-ECR"><span class="level-left"><span class="level-item">5</span><span class="level-item">Upload a custom Docker image to AWS ECR</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#authenticating-to-the-AWS-ECR-repo"><span class="level-left"><span class="level-item">5.1</span><span class="level-item">authenticating to the AWS ECR repo</span></span></a></li><li><a class="level is-mobile" href="#Generate-requirements-txt-for-model-dependency"><span class="level-left"><span class="level-item">5.2</span><span class="level-item">Generate requirements.txt for model dependency</span></span></a></li><li><a class="level is-mobile" href="#Make-dockerfile"><span class="level-left"><span class="level-item">5.3</span><span class="level-item">Make dockerfile</span></span></a></li><li><a class="level is-mobile" href="#Build-and-push-image-file"><span class="level-left"><span class="level-item">5.4</span><span class="level-item">Build and push image file</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Create-a-model-in-sagemaker"><span class="level-left"><span class="level-item">6</span><span class="level-item">Create a model in sagemaker</span></span></a></li><li><a class="level is-mobile" href="#Create-an-Endpoint"><span class="level-left"><span class="level-item">7</span><span class="level-item">Create an Endpoint</span></span></a></li><li><a class="level is-mobile" href="#Check-the-endpoint-status-if-it-is-in-service"><span class="level-left"><span class="level-item">8</span><span class="level-item">Check the endpoint status if it is in-service</span></span></a></li><li><a class="level is-mobile" href="#Invoke-the-endpoint"><span class="level-left"><span class="level-item">9</span><span class="level-item">Invoke the endpoint</span></span></a></li><li><a class="level is-mobile" href="#Review-and-potential-improvements"><span class="level-left"><span class="level-item">10</span><span class="level-item">Review and potential improvements:</span></span></a></li><li><a class="level is-mobile" href="#Conclusion"><span class="level-left"><span class="level-item">11</span><span class="level-item">Conclusion</span></span></a></li><li><a class="level is-mobile" href="#References"><span class="level-left"><span class="level-item">12</span><span class="level-item">References</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><!--!--><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer" style="padding:2rem 0.75rem 2rem;"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/favicon.png" alt="Paddy - Paddy&#039;s Log Book" height="28"></a><p class="is-size-7"><span>&copy; 2023-2024 Paddy</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a> &amp; <a href="/" target="_blank" rel="noopener">Paddy&#039;s FE Tech</a><br><span id="busuanzi_container_page_uv">Visited by <span id="busuanzi_value_page_uv">88</span> users</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent article_license_logo is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent article_license_logo is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent article_license_logo is-large" target="_blank" rel="noopener" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/js/universe.js"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script type="text/javascript" src="/js/gsap_progressbar.js"></script><script type="text/javascript" src="/js/night.js"></script></body></html>